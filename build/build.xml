<project name="SFDX Deploy" default="deployCode" xmlns:sf="antlib:com.salesforce">

   <property file="build.properties"/>
   <property environment="env"/>

   <!-- Setting default value for username, password and session id properties to empty string 
        so unset values are treated as empty. Without this, ant expressions such as ${sf.username}
        will be treated literally.
   -->
   <condition property="sf.username" value=""> <not> <isset property="sf.username"/> </not> </condition>
   <condition property="sf.password" value=""> <not> <isset property="sf.password"/> </not> </condition>
   <condition property="sf.sessionId" value=""> <not> <isset property="sf.sessionId"/> </not> </condition>
   <!-- <typedef resource="org/apache/tools/ant/taskdefs/defaults.properties"/> -->


   <taskdef resource="com/salesforce/antlib.xml" uri="antlib:com.salesforce">

       <classpath>
           <pathelement location="../ant-salesforce.jar" />        	
       </classpath>
   </taskdef>
<target name="runTestsOnlyWithApex">   
    <if>
       <contains string="${build.classes}" substring=".cls"/>
       <then>
          <sf:deploy username="${sf.username}" password="${sf.password}" 
                    serverurl="${sf.serverurl}" deployroot="src" 
                    testLevel="RunSpecifiedTests" runAllTests="false">
             <runTest>${build.tests}</runTest>
          </sf:deploy>
       </then>
    </if>
 </target>

<target name="deployCode">
   <echo message=" baedir is ${basedir}"/>
    <sf:retrieve username="${sf.username}" password="${sf.password}" 
                 serverurl="${sf.serverurl}" retrieveTarget="../force-app/main/default" 
                 unpackaged="../manifest/package.xml"/>
    <antcall target="runTestsOnlyWithApex"/>
 </target>
 </project>